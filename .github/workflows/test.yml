name: Simple Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      id: test
      run: npm test
      continue-on-error: true
    
    - name: Comment on PR if tests fail
      if: failure() && github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          const comment = `‚ùå **Tests Failed**
          
          @${{ github.event.pull_request.user.login }} Your tests are failing. Please check the logs above and fix the issues.
          
          üîç **What to do:**
          1. Check the test results in the "Run tests" step above
          2. Fix the failing tests in your code
          3. Push the fixes to your branch
          
          The tests will run again automatically when you push changes.`;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
    
    - name: Fail job if tests failed
      if: steps.test.outcome == 'failure'
      run: exit 1